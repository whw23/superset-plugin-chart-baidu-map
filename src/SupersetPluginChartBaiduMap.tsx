import React, { useEffect, createRef } from "react"
import ReactEcharts from "echarts-for-react"
import echarts from "echarts";
import 'echarts/extension/bmap/bmap';
import { styled } from '@superset-ui/core';
import { SupersetPluginChartBaiduMapProps } from './types';

const convertData = (data: { [key: string]: any }[], site: string, lon: string, lat: string, adresseColumn: string, metrics: string[]) => {
  var res = data.map((item) => ({
    name: item[site],
    value: [item[lon], item[lat], item[adresseColumn], ...metrics.map(metrics => item[metrics])]
  }))
  return res;
};

const convertSymbol = (useIcon: number, lienSvg: string, defaultIcon: string) => {
  if (useIcon === 1) {
    return defaultIcon
  } else if (useIcon === 2) {
    return 'image://data:image/gif;base64,R0lGODlhcQJxAveZAAAAAD9KVEFLVUROWUZRW0pUXkxXYU5ZY1JcZVNfaVVha1tkbVdjcFlmcV1qdF9teWNsdGFve2RxfGt0fGZ1gWh2gmp6hW59iXR8g3iAh3GBjXyEi3WFkXeIk3mKlnyNmX+QnYCHjoGIj4WLkoiPlYqQloGSn4yTmZCXnJKYnoOVoYaZpYmbp4udq5acoZmepI6hrpuhppCir56kqY+jsJKlspWptperuJqtup2xvqGmq6SqrqarsKmus62xtq+0uLK2ura6vp6zwaG1w6S5x6a7yam+zLm9wavAzr7Cxa7E0rDG1LLJ17XM2rjP3rnQ37zU47/Y5sHEx8LGycbJzMnMz8zP0c7R09HU1tHU1tTX2dTX2dbZ29fZ29ja3Nnb3dnc3drc3trc3sDX5sLZ58Pb6sTb6cPb6snf7Nze4Nze4M3h7d/h49/g4tHj79Xm8Njn8dzq8+Hj5OLj5ePl5uTl5+Lk5eXm6OXn6Ofo6ubo6enq7Orr7Ovt7uzt7urs7ePu9e7v8O7v8Ofw9+/w8ezx9O30+fHy8/Lz9PT09fT19vb29/P09Pf3+PT3+ff4+Pb5+vj5+fn5+vr7+/r6+vv7/P39/f3+/v7+/v///////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAAAAIf8LWE1QIERhdGFYTVA8P3hwYWNrZXQgYmVnaW49J++7vycgaWQ9J1c1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCc/Pgo8eDp4bXBtZXRhIHhtbG5zOng9J2Fkb2JlOm5zOm1ldGEvJyB4OnhtcHRrPSdJbWFnZTo6RXhpZlRvb2wgMTIuNDAnPgo8cmRmOlJERiB4bWxuczpyZGY9J2h0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMnPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6dGlmZj0naHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8nPgogIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiA8L3JkZjpEZXNjcmlwdGlvbj4KPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0ndyc/PgH/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'
  } else if (useIcon === 3) {
    return 'image://' + lienSvg
  }
  return ''
}

const Styles = styled.div`
  /* 隐藏地图bmap左下角logo */
  .anchorBL{
    display:none;
  }
`;

export default function SupersetPluginChartBaiduMap(props: SupersetPluginChartBaiduMapProps) {
  const {
    height, width,
    enableZoom, initZoom,
    centerLon, centerLat,
    useIcon, lienSvg, symbolSize, defaultIcon, defaultIconColor,
    data, lonColumn, latColumn, situationColumn, adresseColumn, metrics,
    usePie, pieSize,
  } = props;
  const rootElem = createRef<HTMLDivElement>();

  // Often, you just want to access the DOM and do whatever you want.
  // Here, you can do that with createRef, and the useEffect hook.
  useEffect(() => {
    // const root = rootElem.current as HTMLElement;
    // console.log('Plugin element', root);
  });

  console.log('Plugin props', props);
  console.log('data', convertData(data, situationColumn, lonColumn, latColumn, adresseColumn, metrics))
  console.log('data[i][metrics]', metrics.map((t: string) => (data[0][t])))

  function randomPieSeries(
    center: any,
    value: any,
  ): echarts.PieSeriesOption {
    var data = metrics.map((t: string, i: number) => ({
      value: value[i],
      name: t
    }));
    return {
      type: 'pie',
      coordinateSystem: 'bmap',
      tooltip: {
        formatter: '{b}: {c} ({d}%)'
      },
      label: {
        show: false
      },
      labelLine: {
        show: false
      },
      radius: [symbolSize / 2, usePie ? symbolSize / 2 + pieSize : symbolSize / 2],
      center,
      data: data,
    };
  }

  function getSeries(): any {
    var res = []
    if (usePie) {
      for (var i = 0; i < data.length; i++) {
        res.push(
          randomPieSeries([data[i][lonColumn], data[i][latColumn]], metrics.map((t: string) => (data[0][t])))
        );
      }
    }
    res.push({
      type: 'scatter',
      coordinateSystem: 'bmap',
      symbolSize: symbolSize,
      data: convertData(data, situationColumn, lonColumn, latColumn, adresseColumn, metrics),
      dimensions: [{ name: '经度' }, { name: '纬度' }, { name: '地址' }].concat(metrics),
      encode: {
        tooltip: ['经度', '纬度', '地址'].concat(metrics),
      },
      symbol: convertSymbol(useIcon, lienSvg, defaultIcon),
      color: `rgba(${defaultIconColor.r},${defaultIconColor.g},${defaultIconColor.b},${defaultIconColor.a})`,
    })
    return res
  }

  const getOptionScatter = () => {
    return {
      bmap: {
        center: [centerLon, centerLat],
        zoom: initZoom,
        roam: enableZoom,
      },
      series: getSeries(),
      tooltip: {
        trigger: 'item',
      },
      legend: {
        show: usePie,
      },
    }
  }

  return (
    <Styles ref={rootElem} >
      <ReactEcharts
        option={getOptionScatter()}
        style={{ height: height, width: width }}
        echarts={echarts}
      />
    </Styles>
  )
};
